#
# Greet the day with a daily briefing
#
# @subscribe input_boolean.night_mode
# @subscribe input_boolean.nap_mode
#
- id: daily_greeting
  alias: Daily greeting
  trigger:
    # When night mode is disabled.
    - platform: state
      entity_id: input_boolean.night_mode
      to: 'off'

  condition:
    # If nap mode is disabled.
    - condition: state
      entity_id: input_boolean.nap_mode
      state: 'off'

  action:
    # Sound the day.
    - service: notify.sound
      data:
        message: "doorbell"
        data:
          method: "alarm"
    - delay:
        seconds: 2

    # Greet the day.
    - service: notify.speech
      data_template:
        message: >-
          {% set temperature = states('sensor.outside_temperature') | int %}
          {% set apparent = states('sensor.dark_sky_apparent_temperature') | round(0) %}
          {% set minutely = states('sensor.dark_sky_minutely_summary') %}
          {% set hourly = states('sensor.dark_sky_hourly_summary') %}
          {% set windspeed = (states('sensor.dark_sky_wind_speed')|float * 3600 / 1000) | round(1) %}

          Good morning beautiful people!
          We are {{ now().strftime('%A') }} {{ states('sensor.date_friendly') }}
          and the time is {{ states('sensor.time_friendly') }}.

          {% if apparent == temperature %}
            Outside temperature is {{ temperature }}Ëš.
          {% else %}
            Outside temperature is {{ temperature }}Ëš but feels like {{ apparent }}.
          {% endif %}

          {% if minutely != 'unknown' %}
            It will be {{ minutely }}
            {% if hourly != 'unknown' %}
              and will be {{ hourly }}
            {% endif %}
          {% else %}
            It is currently {{ states('sensor.dark_sky_summary') }}
            {% if hourly != 'unknown' %}
              and will be {{ hourly }}
            {% else %}
              .
            {% endif %}
          {% endif %}

          {% if 40 <= windspeed %}
            It is windy.
          {% endif %}
          A {{ states('sensor.wind_scale_friendly') }} is blowing
          from the {{ states('sensor.wind_bearing_cardinal_friendly') }}

          Air quality is {{ states('sensor.aqi_friendly') }} and
          UV index is {{ states('sensor.uv_friendly') }}.

          Have a nice day!
          {{ states('sensor.good_vibes') }}
