#
# Check if humidity is too high
#
# Only verify if doors and windows are closed.
#
# @subscribe input_boolean.doors_open
# @subscribe input_boolean.windows_open
#
# @see /automations/check_mold.yaml
#
- id: check_humidity_high
  alias: Check humidity HIGH
  trigger:
    # Comfort level should be between 35% and 55%.
    - platform: numeric_state
      entity_id: sensor.average_humidity
      above: 55
      below: 61

  condition:
    # Doors are closed.
    - condition: state
      entity_id: input_boolean.doors_open
      state: 'off'
      for:
        minutes: 60

    # Windows are closed.
    - condition: state
      entity_id: input_boolean.windows_open
      state: 'off'
      for:
        minutes: 60

  action:
    # Warn someone to take action (like empty the dehumidifier's collection
    # bucket).
    - service: notify.group
      data:
        title: "Home humidity is too high"
        message: |
          {{ states('sensor.average_humidity') }}% is excessive.
          Check the dehumidifier.

    # Pin a warning message in the frontend.
    - service: persistent_notification.create
      data:
        notification_id: humidity
        title: "Humidity is too high"
        message: |
          {{ states('sensor.average_humidity') }}% is excessive.<br>
          Check the dehumidifier.
