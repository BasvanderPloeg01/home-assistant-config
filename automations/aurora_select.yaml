#
# Manually select a Nanoleaf Aurora loaded-in effect.
#
- id: aurora_select
  alias: Aurora SELECT
  trigger:
    # An effect has been selected.
    - platform: state
      entity_id: input_select.aurora_effect

  condition:
    # If an actual effect is selected.
    - condition: template
      value_template: "{% if not is_state('input_select.aurora_effect', 'Auto') %}true{% endif %}"

  action:
    - service: notify.group
      data:
        title: 'Hass.io'
        message: "aurora_select sent: {{ states('input_select.aurora_effect') }}"

    # Override the Aurora effect.
    - service: input_boolean.turn_on
      entity_id: input_boolean.aurora_effect_override

    # Update the effect variable.
    - service: variable.set_variable
      data:
        variable: aurora_effect
        value_template: >-
          {{ states('input_select.aurora_effect') }}


#
# Todo convert into AppDeamon because set_options doesn't understand templates.
#
# see: https://pypkg.com/pypi/homeassistant/f/homeassistant/components/input_select.py
# see: https://home-assistant.io/cookbook/automation_kodi_dynamic_input_select/
#
# - id: aurora_effects_list
#   alias: Aurora effects list
#   trigger:
#     # Every five minutes.
#     - platform: time
#       minutes: /1
#       seconds: 00

#   action:
#     # Populate effects select list.
#     - service: input_select.set_options
#       data_template:
#         entity_id: input_select.aurora_effect
#         options: >
#           "{% for state in states.light.aurora.attributes.effect_list %}"{{ state}}",{% endfor %}"
